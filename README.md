# 校园网上网账号管理系统 v2.0

一个基于Python + Streamlit的校园网ISP账号管理系统，用于管理移动/联通/电信账号的分配、绑定和生命周期管理。采用多页面架构，支持用户列表数据校准。

## 系统特性

### 核心功能
- 📊 **仪表盘**: 实时监控账号池状态和系统健康度
- 🗂️ **账号管理**: ISP账号池管理，批量导入、搜索筛选
- 👥 **用户列表**: 实际绑定关系管理，月度数据校准
- 🚀 **绑定导出**: 自动化缴费处理和账号绑定流程
- ⚙️ **系统设置**: 配置管理和系统维护

### 技术架构
- **后端**: Python 3.8+ + SQLite
- **前端**: Streamlit多页面Web界面
- **数据处理**: Pandas + openpyxl
- **数据库**: SQLite（轻量级，单文件）

## 快速开始

### 1. 环境要求
- Python 3.8 或更高版本
- Windows/Linux/macOS

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 启动系统

#### 方式一：使用启动脚本（Windows）
双击 `start.bat` 文件

#### 方式二：命令行启动
```bash
streamlit run app.py
```

### 4. 访问系统
系统启动后会自动打开浏览器，访问地址：http://localhost:8501

## 使用指南

### 数据导入流程

#### 1. 导入ISP账号池
1. 进入 "🗂️ 账号管理" 页面 (http://localhost:8501/🗂️_账号管理)
2. 下载账号导入模板
3. 填写账号信息（移动账户、账号类型、使用状态）
4. 上传Excel文件完成导入（纯资源池，无绑定信息）

#### 2. 导入用户列表（月度校准）
1. 进入 "👥 用户列表" 页面 (http://localhost:8501/👥_用户列表)
2. 下载用户列表模板
3. 填写用户信息（用户账号、绑定套餐、用户姓名、用户类别、移动账号、到期日期）
4. 上传Excel文件导入实际绑定关系
5. 点击"执行数据校准"同步绑定状态到账号池

#### 3. 处理缴费记录
1. 进入 "🚀 绑定与导出" 页面 (http://localhost:8501/🚀_绑定导出)
2. 上传收费Excel文件（用户账号、收费时间、收费金额）
3. 点击"执行绑定任务"自动分配账号
4. 下载生成的批量修改文件

### 账号类型说明

- **202409格式**: 按年月计算生命周期（如2024年9月到2025年9月）
- **0元账号**: 使用系统设置中的统一到期日
- 支持自定义账号类型扩展

### 系统维护

#### 自动维护任务包括：
- 🔓 释放套餐过期但账号未过期的绑定
- ❌ 标记生命周期结束的账号为过期
- ⏰ 更新系统维护时间戳

#### 手动维护：
- 在"系统设置"页面执行
- 支持分别执行释放和过期操作
- 提供数据库清理功能

## 文件结构

```
Account_manager/
├── app.py                 # 主应用入口
├── start.bat             # Windows启动脚本
├── requirements.txt      # 依赖列表
├── database/            # 数据库模块
│   ├── models.py        # 数据库模型
│   └── operations.py    # 数据库操作
├── utils/               # 工具模块
│   ├── excel_handler.py # Excel处理
│   ├── date_utils.py    # 日期工具
│   └── business_logic.py# 业务逻辑
├── pages/               # 页面模块
│   ├── dashboard.py     # 仪表盘
│   ├── account_management.py # 账号管理
│   ├── binding_export.py     # 绑定导出
│   └── settings.py           # 系统设置
├── data/                # 数据目录
│   ├── account_manager.db    # SQLite数据库
│   └── *.xlsx               # 导入导出文件
└── templates/           # 模板文件
```

## Excel文件格式

### 账号导入文件
| 移动账户 | 账号类型 | 使用状态 |
|---------|---------|---------|
| 示例账号 | 202409  | 未使用   |

### 缴费记录文件
| 用户账号 | 收费时间 | 收费金额 |
|---------|---------|---------|
| 示例学号 | 2024-01-01 10:00:00 | 30.0 |

### 绑定详情文件
| 用户账号 | 移动账号 | 到期日期 |
|---------|---------|---------|
| 示例学号 | 示例移动账号 | 2024-12-31 |

## 常见问题

### Q: 系统启动失败
A: 检查Python版本和依赖是否正确安装

### Q: Excel导入失败
A: 确认文件格式正确，列名完全匹配模板

### Q: 账号分配失败
A: 检查可用账号池是否充足

### Q: 数据库错误
A: 删除data目录下的.db文件，重新启动系统

## 系统配置

### 数据库配置
- 数据库文件: `data/account_manager.db`
- 自动创建表结构和初始设置

### 0元账号配置
- 在"系统设置"页面配置
- 支持统一到期日期管理

## 技术支持

系统基于设计文档 `develop.md` 实现，包含完整的业务流程和数据模型设计。

如有问题请检查：
1. 系统日志和错误信息
2. Excel文件格式是否正确
3. 数据库连接是否正常